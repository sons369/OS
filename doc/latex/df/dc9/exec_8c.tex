\hypertarget{exec_8c}{}\doxysection{exec.\+c 파일 참조}
\label{exec_8c}\index{exec.c@{exec.c}}
{\ttfamily \#include \char`\"{}types.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}param.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}memlayout.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}mmu.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}proc.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}defs.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}x86.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}elf.\+h\char`\"{}}\newline
exec.\+c에 대한 include 의존 그래프
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d3/dd9/exec_8c__incl}
\end{center}
\end{figure}
\doxysubsection*{함수}
\begin{DoxyCompactItemize}
\item 
int \mbox{\hyperlink{exec_8c_ace32454ed0d37834dcb1cb4f8b727e6e}{exec}} (char $\ast$path, char $\ast$$\ast$\mbox{\hyperlink{init_8c_abd1a2cf54950f450187ef24c1cdcac0c}{argv}})
\end{DoxyCompactItemize}


\doxysubsection{함수 문서화}
\mbox{\Hypertarget{exec_8c_ace32454ed0d37834dcb1cb4f8b727e6e}\label{exec_8c_ace32454ed0d37834dcb1cb4f8b727e6e}} 
\index{exec.c@{exec.c}!exec@{exec}}
\index{exec@{exec}!exec.c@{exec.c}}
\doxysubsubsection{\texorpdfstring{exec()}{exec()}}
{\footnotesize\ttfamily int exec (\begin{DoxyParamCaption}\item[{char $\ast$}]{path,  }\item[{char $\ast$$\ast$}]{argv }\end{DoxyParamCaption})}



exec.\+c 파일의 11 번째 라인에서 정의되었습니다.


\begin{DoxyCode}{0}
\DoxyCodeLine{12 \{}
\DoxyCodeLine{13   \textcolor{keywordtype}{char} *s, *last;}
\DoxyCodeLine{14   \textcolor{keywordtype}{int} i, off;}
\DoxyCodeLine{15   \mbox{\hyperlink{types_8h_a91ad9478d81a7aaf2593e8d9c3d06a14}{uint}} argc, sz, sp, ustack[3+\mbox{\hyperlink{param_8h_a4c171d1ccc50f0b6ce7ad2f475eeba32}{MAXARG}}+1];}
\DoxyCodeLine{16   \textcolor{keyword}{struct }\mbox{\hyperlink{structelfhdr}{elfhdr}} \mbox{\hyperlink{structelfhdr_a22ec6f2383f0488ee18a18673398f201}{elf}};}
\DoxyCodeLine{17   \textcolor{keyword}{struct }\mbox{\hyperlink{structinode}{inode}} *ip;}
\DoxyCodeLine{18   \textcolor{keyword}{struct }\mbox{\hyperlink{structproghdr}{proghdr}} ph;}
\DoxyCodeLine{19   \mbox{\hyperlink{types_8h_ac131849542282b2c95dfeaf1f26dc010}{pde\_t}} *pgdir, *oldpgdir;}
\DoxyCodeLine{20   \textcolor{keyword}{struct }\mbox{\hyperlink{structproc}{proc}} *curproc = \mbox{\hyperlink{defs_8h_addb64b689e3c266aaa67cc0126bba441}{myproc}}();}
\DoxyCodeLine{21 }
\DoxyCodeLine{22   \mbox{\hyperlink{defs_8h_a603ca98212e00d2ffdba7827ef0f1003}{begin\_op}}();}
\DoxyCodeLine{23 }
\DoxyCodeLine{24   \textcolor{keywordflow}{if}((ip = \mbox{\hyperlink{defs_8h_a29aa723e0b59f069c9eba588fdeb7e5a}{namei}}(path)) == 0)\{}
\DoxyCodeLine{25     \mbox{\hyperlink{defs_8h_a2504e37a109f9bae5ca11fe89e4e8fa1}{end\_op}}();}
\DoxyCodeLine{26     \mbox{\hyperlink{console_8c_a90f0742d846503e4ed1804f1df421ec6}{cprintf}}(\textcolor{stringliteral}{"exec: fail\(\backslash\)n"});}
\DoxyCodeLine{27     \textcolor{keywordflow}{return} -\/1;}
\DoxyCodeLine{28   \}}
\DoxyCodeLine{29   \mbox{\hyperlink{defs_8h_a29a4d743d41fe659f74b0a57fdc25012}{ilock}}(ip);}
\DoxyCodeLine{30   \mbox{\hyperlink{structproc_ad430afc653e9eb6cee33954d5545b79d}{pgdir}} = 0;}
\DoxyCodeLine{31 }
\DoxyCodeLine{32   \textcolor{comment}{// Check ELF header}}
\DoxyCodeLine{33   \textcolor{keywordflow}{if}(\mbox{\hyperlink{defs_8h_a2415273b06f31f0f2587b7325588a7e4}{readi}}(ip, (\textcolor{keywordtype}{char}*)\&elf, 0, \textcolor{keyword}{sizeof}(elf)) != \textcolor{keyword}{sizeof}(elf))}
\DoxyCodeLine{34     \textcolor{keywordflow}{goto} bad;}
\DoxyCodeLine{35   \textcolor{keywordflow}{if}(elf.magic != \mbox{\hyperlink{elf_8h_abb1c2e5626667aacc7b3efd269a6c0eb}{ELF\_MAGIC}})}
\DoxyCodeLine{36     \textcolor{keywordflow}{goto} bad;}
\DoxyCodeLine{37 }
\DoxyCodeLine{38   \textcolor{keywordflow}{if}((\mbox{\hyperlink{structproc_ad430afc653e9eb6cee33954d5545b79d}{pgdir}} = \mbox{\hyperlink{defs_8h_aa7dbd3b5c70eb93e0e7fb8331202821d}{setupkvm}}()) == 0)}
\DoxyCodeLine{39     \textcolor{keywordflow}{goto} bad;}
\DoxyCodeLine{40 }
\DoxyCodeLine{41   \textcolor{comment}{// Load program into memory.}}
\DoxyCodeLine{42   \mbox{\hyperlink{structproc_a6e67042bb361124ff287af88efc33e00}{sz}} = 0;}
\DoxyCodeLine{43   \textcolor{keywordflow}{for}(i=0, off=elf.phoff; i<elf.phnum; i++, off+=\textcolor{keyword}{sizeof}(ph))\{}
\DoxyCodeLine{44     \textcolor{keywordflow}{if}(\mbox{\hyperlink{defs_8h_a2415273b06f31f0f2587b7325588a7e4}{readi}}(ip, (\textcolor{keywordtype}{char}*)\&ph, off, \textcolor{keyword}{sizeof}(ph)) != \textcolor{keyword}{sizeof}(ph))}
\DoxyCodeLine{45       \textcolor{keywordflow}{goto} bad;}
\DoxyCodeLine{46     \textcolor{keywordflow}{if}(ph.type != \mbox{\hyperlink{elf_8h_a6a45c035b7a2930e62ac97a6bd8121e9}{ELF\_PROG\_LOAD}})}
\DoxyCodeLine{47       \textcolor{keywordflow}{continue};}
\DoxyCodeLine{48     \textcolor{keywordflow}{if}(ph.memsz < ph.filesz)}
\DoxyCodeLine{49       \textcolor{keywordflow}{goto} bad;}
\DoxyCodeLine{50     \textcolor{keywordflow}{if}(ph.vaddr + ph.memsz < ph.vaddr)}
\DoxyCodeLine{51       \textcolor{keywordflow}{goto} bad;}
\DoxyCodeLine{52     \textcolor{keywordflow}{if}((\mbox{\hyperlink{structproc_a6e67042bb361124ff287af88efc33e00}{sz}} = \mbox{\hyperlink{defs_8h_a67f50b6f85756f02b5acdcb084d51b9f}{allocuvm}}(\mbox{\hyperlink{structproc_ad430afc653e9eb6cee33954d5545b79d}{pgdir}}, \mbox{\hyperlink{structproc_a6e67042bb361124ff287af88efc33e00}{sz}}, ph.vaddr + ph.memsz)) == 0)}
\DoxyCodeLine{53       \textcolor{keywordflow}{goto} bad;}
\DoxyCodeLine{54     \textcolor{keywordflow}{if}(ph.vaddr \% \mbox{\hyperlink{mmu_8h_a5f96cb6ae6670e023c407cc2f77e1704}{PGSIZE}} != 0)}
\DoxyCodeLine{55       \textcolor{keywordflow}{goto} bad;}
\DoxyCodeLine{56     \textcolor{keywordflow}{if}(\mbox{\hyperlink{defs_8h_a8a149272578e00e0ce70480004640679}{loaduvm}}(\mbox{\hyperlink{structproc_ad430afc653e9eb6cee33954d5545b79d}{pgdir}}, (\textcolor{keywordtype}{char}*)ph.vaddr, ip, ph.off, ph.filesz) < 0)}
\DoxyCodeLine{57       \textcolor{keywordflow}{goto} bad;}
\DoxyCodeLine{58   \}}
\DoxyCodeLine{59   \mbox{\hyperlink{defs_8h_adff5bb5a1eeaf921853ec06479f8c49b}{iunlockput}}(ip);}
\DoxyCodeLine{60   \mbox{\hyperlink{defs_8h_a2504e37a109f9bae5ca11fe89e4e8fa1}{end\_op}}();}
\DoxyCodeLine{61   ip = 0;}
\DoxyCodeLine{62 }
\DoxyCodeLine{63   \textcolor{comment}{// Allocate two pages at the next page boundary.}}
\DoxyCodeLine{64   \textcolor{comment}{// Make the first inaccessible.  Use the second as the user stack.}}
\DoxyCodeLine{65   \mbox{\hyperlink{structproc_a6e67042bb361124ff287af88efc33e00}{sz}} = \mbox{\hyperlink{mmu_8h_affa8cdfbd1c15dafc9f3af3a7b641f80}{PGROUNDUP}}(\mbox{\hyperlink{structproc_a6e67042bb361124ff287af88efc33e00}{sz}});}
\DoxyCodeLine{66   \textcolor{keywordflow}{if}((\mbox{\hyperlink{structproc_a6e67042bb361124ff287af88efc33e00}{sz}} = \mbox{\hyperlink{defs_8h_a67f50b6f85756f02b5acdcb084d51b9f}{allocuvm}}(\mbox{\hyperlink{structproc_ad430afc653e9eb6cee33954d5545b79d}{pgdir}}, \mbox{\hyperlink{structproc_a6e67042bb361124ff287af88efc33e00}{sz}}, \mbox{\hyperlink{structproc_a6e67042bb361124ff287af88efc33e00}{sz}} + 2*\mbox{\hyperlink{mmu_8h_a5f96cb6ae6670e023c407cc2f77e1704}{PGSIZE}})) == 0)}
\DoxyCodeLine{67     \textcolor{keywordflow}{goto} bad;}
\DoxyCodeLine{68   \mbox{\hyperlink{defs_8h_a795e27a0cb916cfb41411ebbb9669ddf}{clearpteu}}(\mbox{\hyperlink{structproc_ad430afc653e9eb6cee33954d5545b79d}{pgdir}}, (\textcolor{keywordtype}{char}*)(\mbox{\hyperlink{structproc_a6e67042bb361124ff287af88efc33e00}{sz}} -\/ 2*\mbox{\hyperlink{mmu_8h_a5f96cb6ae6670e023c407cc2f77e1704}{PGSIZE}}));}
\DoxyCodeLine{69   sp = \mbox{\hyperlink{structproc_a6e67042bb361124ff287af88efc33e00}{sz}};}
\DoxyCodeLine{70 }
\DoxyCodeLine{71   \textcolor{comment}{// Push argument strings, prepare rest of stack in ustack.}}
\DoxyCodeLine{72   \textcolor{keywordflow}{for}(argc = 0; \mbox{\hyperlink{init_8c_abd1a2cf54950f450187ef24c1cdcac0c}{argv}}[argc]; argc++) \{}
\DoxyCodeLine{73     \textcolor{keywordflow}{if}(argc >= \mbox{\hyperlink{param_8h_a4c171d1ccc50f0b6ce7ad2f475eeba32}{MAXARG}})}
\DoxyCodeLine{74       \textcolor{keywordflow}{goto} bad;}
\DoxyCodeLine{75     sp = (sp -\/ (\mbox{\hyperlink{defs_8h_a5e5172aa1be36b8210c6dfd86800b44c}{strlen}}(\mbox{\hyperlink{init_8c_abd1a2cf54950f450187ef24c1cdcac0c}{argv}}[argc]) + 1)) \& \string~3;}
\DoxyCodeLine{76     \textcolor{keywordflow}{if}(\mbox{\hyperlink{defs_8h_a11f5ff2e5bcd16968a88fcbb30db5a10}{copyout}}(\mbox{\hyperlink{structproc_ad430afc653e9eb6cee33954d5545b79d}{pgdir}}, sp, \mbox{\hyperlink{init_8c_abd1a2cf54950f450187ef24c1cdcac0c}{argv}}[argc], \mbox{\hyperlink{defs_8h_a5e5172aa1be36b8210c6dfd86800b44c}{strlen}}(\mbox{\hyperlink{init_8c_abd1a2cf54950f450187ef24c1cdcac0c}{argv}}[argc]) + 1) < 0)}
\DoxyCodeLine{77       \textcolor{keywordflow}{goto} bad;}
\DoxyCodeLine{78     ustack[3+argc] = sp;}
\DoxyCodeLine{79   \}}
\DoxyCodeLine{80   ustack[3+argc] = 0;}
\DoxyCodeLine{81 }
\DoxyCodeLine{82   ustack[0] = 0xffffffff;  \textcolor{comment}{// fake return PC}}
\DoxyCodeLine{83   ustack[1] = argc;}
\DoxyCodeLine{84   ustack[2] = sp -\/ (argc+1)*4;  \textcolor{comment}{// argv pointer}}
\DoxyCodeLine{85 }
\DoxyCodeLine{86   sp -\/= (3+argc+1) * 4;}
\DoxyCodeLine{87   \textcolor{keywordflow}{if}(\mbox{\hyperlink{defs_8h_a11f5ff2e5bcd16968a88fcbb30db5a10}{copyout}}(\mbox{\hyperlink{structproc_ad430afc653e9eb6cee33954d5545b79d}{pgdir}}, sp, ustack, (3+argc+1)*4) < 0)}
\DoxyCodeLine{88     \textcolor{keywordflow}{goto} bad;}
\DoxyCodeLine{89 }
\DoxyCodeLine{90   \textcolor{comment}{// Save program name for debugging.}}
\DoxyCodeLine{91   \textcolor{keywordflow}{for}(last=s=path; *s; s++)}
\DoxyCodeLine{92     \textcolor{keywordflow}{if}(*s == \textcolor{charliteral}{'/'})}
\DoxyCodeLine{93       last = s+1;}
\DoxyCodeLine{94   \mbox{\hyperlink{defs_8h_a3e26eb6d2dbf34cf09486f4c0295ae3f}{safestrcpy}}(curproc-\/>\mbox{\hyperlink{structproc_ac04af53e17d24b90c3cbfab56d658d62}{name}}, last, \textcolor{keyword}{sizeof}(curproc-\/>\mbox{\hyperlink{structproc_ac04af53e17d24b90c3cbfab56d658d62}{name}}));}
\DoxyCodeLine{95 }
\DoxyCodeLine{96   \textcolor{comment}{// Commit to the user image.}}
\DoxyCodeLine{97   oldpgdir = curproc-\/>\mbox{\hyperlink{structproc_ad430afc653e9eb6cee33954d5545b79d}{pgdir}};}
\DoxyCodeLine{98   curproc-\/>\mbox{\hyperlink{structproc_ad430afc653e9eb6cee33954d5545b79d}{pgdir}} = \mbox{\hyperlink{structproc_ad430afc653e9eb6cee33954d5545b79d}{pgdir}};}
\DoxyCodeLine{99   curproc-\/>\mbox{\hyperlink{structproc_a6e67042bb361124ff287af88efc33e00}{sz}} = \mbox{\hyperlink{structproc_a6e67042bb361124ff287af88efc33e00}{sz}};}
\DoxyCodeLine{100   curproc-\/>\mbox{\hyperlink{structproc_a56ec07ac1e10ce42adfc8dd2a366071f}{tf}}-\/>\mbox{\hyperlink{structtrapframe_a886a5973a537894e3a95435f38767d5c}{eip}} = elf.entry;  \textcolor{comment}{// main}}
\DoxyCodeLine{101   curproc-\/>\mbox{\hyperlink{structproc_a56ec07ac1e10ce42adfc8dd2a366071f}{tf}}-\/>\mbox{\hyperlink{structtrapframe_acd319e2dbd720d217c10f8fb620d73e2}{esp}} = sp;}
\DoxyCodeLine{102   \mbox{\hyperlink{defs_8h_ad43d81fa3edec39a200abd0853bc84b1}{switchuvm}}(curproc);}
\DoxyCodeLine{103   \mbox{\hyperlink{defs_8h_af24cf1756e19afd8be8c95d02262cf3a}{freevm}}(oldpgdir);}
\DoxyCodeLine{104   \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{105 }
\DoxyCodeLine{106  bad:}
\DoxyCodeLine{107   \textcolor{keywordflow}{if}(\mbox{\hyperlink{structproc_ad430afc653e9eb6cee33954d5545b79d}{pgdir}})}
\DoxyCodeLine{108     \mbox{\hyperlink{defs_8h_af24cf1756e19afd8be8c95d02262cf3a}{freevm}}(\mbox{\hyperlink{structproc_ad430afc653e9eb6cee33954d5545b79d}{pgdir}});}
\DoxyCodeLine{109   \textcolor{keywordflow}{if}(ip)\{}
\DoxyCodeLine{110     \mbox{\hyperlink{defs_8h_adff5bb5a1eeaf921853ec06479f8c49b}{iunlockput}}(ip);}
\DoxyCodeLine{111     \mbox{\hyperlink{defs_8h_a2504e37a109f9bae5ca11fe89e4e8fa1}{end\_op}}();}
\DoxyCodeLine{112   \}}
\DoxyCodeLine{113   \textcolor{keywordflow}{return} -\/1;}
\DoxyCodeLine{114 \}}

\end{DoxyCode}
이 함수 내부에서 호출하는 함수들에 대한 그래프입니다.\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=550pt]{df/dc9/exec_8c_ace32454ed0d37834dcb1cb4f8b727e6e_cgraph}
\end{center}
\end{figure}
이 함수를 호출하는 함수들에 대한 그래프입니다.\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=298pt]{df/dc9/exec_8c_ace32454ed0d37834dcb1cb4f8b727e6e_icgraph}
\end{center}
\end{figure}
